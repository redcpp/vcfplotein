<template>
  <base-titled-section title="Filter genes" role="tablist">
    <b-nav pills class="nav-pills">
      <b-nav-item v-for="item in list"
        :active="cur.key === item.key"
        :class="{ active: (cur.key === item.key) }"
        :key="item.key"
        @click="setCurrent(item)"
      >
        {{item.title}}
      </b-nav-item>
    </b-nav>
    <div class="pt-3">
      <chromosome-filter v-if="cur.key === 'chr'" />
      <spinner v-else-if="mySpinner" />
      <goterms-filter v-else-if="cur.key === 'bio'" :list="bio" :title="cur.title" />
      <goterms-filter v-else-if="cur.key === 'mol'" :list="mol" :title="cur.title" />
      <goterms-filter v-else-if="cur.key === 'cel'" :list="cel" :title="cur.title" />
      <p v-else>Error</p>
    </div>
  </base-titled-section>
</template>

<script>
  import { mapGetters, mapActions } from 'vuex'

  import ChromosomeFilter from '~/components/wizard/ChromosomeFilter'
  import GotermsFilter from '~/components/wizard/GotermsFilter'
  import Spinner from '~/components/Spinner'

  const list = [
    {title: 'Chromosome', key: 'chr'},
    {title: 'Biological process', key: 'bio'},
    {title: 'Molecular function', key: 'mol'},
    {title: 'Cellular component', key: 'cel'}
  ]

  export default {
    components: {
      ChromosomeFilter,
      GotermsFilter,
      Spinner
    },
    data: () => ({
      list: list,
      cur: list[0],
      fetchedGoterms: false,
    }),
    computed: {
      ...mapGetters({
        myGoterms: 'getGoterms',
        mySpinner: 'getSpinner',
      }),
      bio () {
        return this.myGoterms['biological_process']
      },
      mol () {
        return this.myGoterms['molecular_function']
      },
      cel () {
        return this.myGoterms['cellular_component']
      }
    },
    methods: {
      ...mapActions({
        setGoterms: 'setGoterms',
      }),
      setCurrent (item) {
        this.cur = item
        if (!this.fetchedGoterms) {
          this.fetchedGoterms = true
          this.setGoterms()
        }
      }
    }
  }
</script>
